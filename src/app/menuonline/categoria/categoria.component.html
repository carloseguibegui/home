<app-background [imageUrl]="backgroundImage"></app-background>

<!-- Spinner -->
<app-spinner [@fadeInOut] *ngIf="loading"></app-spinner>
<p-confirmDialog [style]="{ width: 'min(92vw, 460px)' }"></p-confirmDialog>

<!-- Contenido principal -->
<div [@fadeContent]>
        <div [ngClass]="clienteClass" class="carta-container" [style.--card-bg]="'url(' + cardImage + ')'">
                <section *ngIf="!loading" class="content fade-in" [class.fade]="true" [class.show]="visible">
                        <!-- Header -->
                        <app-header [cliente]="cliente" [src_path]="logoImage"></app-header>

                        <!-- Slider de categorías -->
                        <app-slider [categorias]="categorias" [cliente]="cliente" [categoriaActual]="categoria"
                                (categoriaSeleccionada)="onCategoriaSeleccionada($event)">
                        </app-slider>

                        <!-- Barra de búsqueda -->
                        <app-search-bar [item_placeholder]="item_placeholder" (search)="onSearch($event)">
                        </app-search-bar>

                        <!-- Contenedor de productos -->
                        <div class="container py-4">
                                <div class="row g-4 mt-3">
                                        @for (item of items; track item.idProducto || item.nombre) {
                                        <div class="col-md-4 px-4 text-center" id="cart-item">
                                                <div class="card shadow-sm border-3 rounded-5 overflow-hidden div-carta position-relative"
                                                        style="max-width: 400px;">
                                                        <div class="blurred-load text-center position-relative"
                                                                (click)="openLightbox(item.imagen)"
                                                                [style.backgroundImage]="'url(' + item.small_imagen + ')'">
                                                                <img [src]="item.imagen" [alt]="item.nombre"
                                                                        loading="lazy" decoding="async"
                                                                        class="img-fluid w-100 object-fit-cover"
                                                                        [srcset]="item.small_imagen + ' 320w, ' + item.imagen + ' 800w'"
                                                                        sizes="(max-width: 768px) 100vw, 400px"
                                                                        width="800" height="667"
                                                                        (error)="item.imagen = 'assets/placeholder.png'" />
                                                        </div>
                                                        <div class="blurred-img card-body text-center px-4 pb-4 position-relative"
                                                                id="cuerpo-card">
                                                                <div id="card-nombre" class="pb-2 px-1">
                                                                        <div class="card-title fw-bold text-uppercase">
                                                                                <span
                                                                                        class="card-title-text">{{item.nombre}}</span>
                                                                                @if(item.isVegan) {
                                                                                <button type="button"
                                                                                        class="icon-info-button"
                                                                                        aria-label="Información producto vegano"
                                                                                        title="Producto vegano"
                                                                                        (click)="showVeganInfo($event)">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                                                width="23"
                                                                                                viewBox="0 0 24 24"
                                                                                                fill="#1E382D">
                                                                                                <g fill="none"
                                                                                                        stroke="#1E382D"
                                                                                                        stroke-linecap="round"
                                                                                                        stroke-linejoin="round"
                                                                                                        stroke-width="2">
                                                                                                        <path
                                                                                                                d="M2 2a26.6 26.6 0 0 1 10 20c.9-6.82 1.5-9.5 4-14m0 0c4 0 6-2 6-6c-4 0-6 2-6 6" />
                                                                                                        <path
                                                                                                                d="M17.41 3.6a10 10 0 1 0 3 3" />
                                                                                                </g>
                                                                                        </svg>
                                                                                </button>
                                                                                }
                                                                                @if (item.isGlutenFree) {
                                                                                <button type="button"
                                                                                        class="icon-info-button"
                                                                                        aria-label="Información producto sin gluten"
                                                                                        title="Producto sin gluten"
                                                                                        (click)="showGlutenFreeInfo($event)">
                                                                                        <svg class="gluten-free-icon"
                                                                                                xmlns="http://www.w3.org/2000/svg"
                                                                                                viewBox="0 0 48 48"
                                                                                                aria-hidden="true"
                                                                                                role="img"
                                                                                                focusable="false">
                                                                                                <path fill-rule="evenodd"
                                                                                                        d="M44 24c0 11.046-8.954 20-20 20S4 35.046 4 24S12.954 4 24 4s20 8.954 20 20m-7.999 13.416A17.933 17.933 0 0 1 24 42c-9.941 0-18-8.059-18-18c0-4.738 1.83-9.048 4.823-12.263l3.97 3.97a1 1 0 0 0 1.414-1.414l-3.942-3.942A17.93 17.93 0 0 1 24 6c9.941 0 18 8.059 18 18c0 4.61-1.734 8.817-4.584 12.001l-8.545-8.544A5.726 5.726 0 0 0 31 23l-2.162.34A5.723 5.723 0 0 0 25 25.766v-2.923l1.162-.183A5.73 5.73 0 0 0 31 17l-2.162.34A5.723 5.723 0 0 0 25 19.766V18l.465-.465a5 5 0 0 0 0-7.07L24 9l-1.464 1.464a5 5 0 0 0 0 7.071L23 18v1.766a5.723 5.723 0 0 0-3.838-2.426L17 17a5.73 5.73 0 0 0 4.838 5.66l1.162.183v2.923a5.723 5.723 0 0 0-3.838-2.426L17 23a5.73 5.73 0 0 0 4.838 5.66l1.162.183v2.923a5.723 5.723 0 0 0-3.838-2.426L17 29a5.73 5.73 0 0 0 4.838 5.66l1.162.183V38h2v-3.547a1.78 1.78 0 0 0 1.162.207a5.727 5.727 0 0 0 4.15-2.935zm-7.907-7.907l-1.057-1.058a5.753 5.753 0 0 1-.875.209L25 28.843v2.923a5.727 5.727 0 0 1 3.094-2.257"
                                                                                                        clip-rule="evenodd" />
                                                                                        </svg>
                                                                                </button>
                                                                                }
                                                                                <a *ngIf="whatsappNumber"
                                                                                        class="share-whatsapp" href="#"
                                                                                        (click)="onShareClick($event, item)"
                                                                                        aria-label="Compartir producto por WhatsApp"
                                                                                        title="Compartir por WhatsApp">

                                                                                        <!-- <svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 1025 1024">
                                                                                                <path fill="#fffff"
                                                                                                        d="M896.428 1024h-768q-53 0-90.5-37.5T.428 896V128q0-53 37.5-90.5t90.5-37.5h448v128h-384q-27 0-45.5 19t-18.5 45v640q0 27 18.5 45.5t45.5 18.5h640q27 0 45.5-18.5t18.5-45.5V530l128-107v473q0 53-37.5 90.5t-90.5 37.5zm-200-457q-13 13-34.5 8t-21.5-19V384q-224 0-384 320v-64q0-116 30-204t83-140t121-78t150-26V22q0-14 21.5-19.5t34.5 7.5l314 246q13 13 13 32t-13 33z" />
                                                                                        </svg> -->
                                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                                                fill="none"
                                                                                                viewBox="0 0 30 30"
                                                                                                id="Shopping-Cart-Add--Streamline-Core-Remix"
                                                                                                height="30" width="30">
                                                                                                <g
                                                                                                        id="Free Remix/Money Shopping/shopping-cart-add--shopping-cart-checkout-add-plus-new">
                                                                                                        <path id="Union"
                                                                                                                fill-rule="evenodd"
                                                                                                                d="M1.3392857142857142 0C0.5996185714285714 0 0 0.5996185714285714 0 1.3392857142857142s0.5996185714285714 1.3392857142857142 1.3392857142857142 1.3392857142857142h3.8963785714285715l0.43875 4.158385714285714 1.3802142857142856 13.081457142857143c0.18722142857142857 1.7745857142857142 1.6860000000000002 3.1172999999999997 3.4679571428571427 3.1172999999999997h13.304485714285713c1.5979285714285714 0 2.9939999999999998 -1.085142857142857 3.3827142857142856 -2.636892857142857l2.684785714285714 -10.714285714285714C30.446357142857142 7.482664285714285 28.776642857142857 5.357142857142857 26.511857142857142 5.357142857142857H8.211728571428571L7.772978571428571 1.1987592857142855C7.701064285714286 0.5172749999999999 7.1263499999999995 0 6.441085714285714 0H1.3392857142857142Zm8.379128571428572 19.637378571428574L8.494328571428571 8.035714285714285h18.01752857142857c0.5297142857142857 0 0.9105 0.49472142857142853 0.7845 0.9977571428571428l-2.684785714285714 10.714285714285714c-0.08914285714285713 0.35618571428571427 -0.4114285714285714 0.6093857142857143 -0.7845 0.6093857142857143H10.522585714285714c-0.41642142857142855 0 -0.7612714285714286 -0.3131357142857143 -0.8041714285714285 -0.7197642857142857ZM17.366764285714286 9.375c0.8876142857142857 0 1.6071428571428572 0.7195499999999999 1.6071428571428572 1.6071428571428572v1.6071428571428572h1.6071428571428572c0.8875928571428572 0 1.6071642857142856 0.7195499999999999 1.6071642857142856 1.6071428571428572s-0.7195714285714285 1.6071428571428572 -1.6071642857142856 1.6071428571428572h-1.6071428571428572v1.6071428571428572c0 0.8875928571428572 -0.7195285714285714 1.6071428571428572 -1.6071428571428572 1.6071428571428572 -0.8875928571428572 0 -1.6071428571428572 -0.7195499999999999 -1.6071428571428572 -1.6071428571428572v-1.6071428571428572h-1.6071428571428572c-0.8875928571428572 0 -1.6071428571428572 -0.7195499999999999 -1.6071428571428572 -1.6071428571428572s0.7195499999999999 -1.6071428571428572 1.6071428571428572 -1.6071428571428572h1.6071428571428572v-1.6071428571428572c0 -0.8875928571428572 0.7195499999999999 -1.6071428571428572 1.6071428571428572 -1.6071428571428572Zm8.499664285714285 18.214285714285715c0 -1.3313571428571427 -1.0791428571428572 -2.4107142857142856 -2.4107142857142856 -2.4107142857142856 -1.3313571428571427 0 -2.410628571428571 1.079357142857143 -2.410628571428571 2.4107142857142856S22.124357142857143 30 23.455714285714283 30c1.3315714285714284 0 2.4107142857142856 -1.079357142857143 2.4107142857142856 -2.4107142857142856ZM9.527228571428571 25.178571428571427c1.3314214285714285 0 2.4107142857142856 1.079357142857143 2.4107142857142856 2.4107142857142856S10.85865 30 9.527228571428571 30c-1.3314 0 -2.4107142857142856 -1.079357142857143 -2.4107142857142856 -2.4107142857142856s1.0793142857142857 -2.4107142857142856 2.4107142857142856 -2.4107142857142856Z"
                                                                                                                clip-rule="evenodd"
                                                                                                                stroke-width="2.1429">
                                                                                                        </path>
                                                                                                </g>
                                                                                        </svg>
                                                                                </a>
                                                                        </div>
                                                                </div>
                                                                <div id="card-descripcion">
                                                                        <span id="card-descripcion-span"
                                                                                aria-hidden="true">“</span>
                                                                        {{ item.descripcion }}.
                                                                </div>
                                                                @if (item._variantesEntries) {
                                                                @for (v of item._variantesEntries; track v[0]) {
                                                                <div class="btn rounded-3 d-block" id="boton-card">
                                                                        {{ v[0] }}: ${{ v[1] }}
                                                                </div>
                                                                }
                                                                }
                                                                @if (item.precio && !item.variantes) {
                                                                <div class="btn rounded-3 d-block" id="boton-card">
                                                                        ${{ item.precio }}
                                                                </div>
                                                                }
                                                                @if (item._extrasEntries) {
                                                                @for (e of item._extrasEntries; track e[0]) {
                                                                <div class="btn rounded-3 d-block extras"
                                                                        id="boton-card">
                                                                        {{ e[0] }}: ${{ e[1] }}
                                                                </div>
                                                                }
                                                                }
                                                        </div>
                                                </div>
                                        </div>
                                        }

                                        <a [routerLink]="['/menuonline', cliente, 'carta']"
                                                class="btn button-add-cart checkout-button boton-volver">
                                                <span aria-hidden="true" style="padding-right: 7px;">↺</span>VOLVER
                                        </a>
                                </div>

                                <!-- Lightbox -->
                                <div class="lightbox" [class.show]="lightboxVisible"
                                        [class.hide]="!lightboxVisible && lightboxImage"
                                        (click)="closeLightbox($event)">
                                        <span *ngIf="zoomLevel === 1" class="lightbox-close"
                                                (click)="closeLightbox($event)" aria-label="Cerrar" tabindex="0"
                                                role="button"
                                                style="position: absolute; top: 24px; right: 32px; font-size: 2.5rem; color: #fff; z-index: 10; cursor: pointer; user-select: none;">
                                                &times;
                                        </span>
                                        <img class="lightbox-content" [src]="lightboxImage" (dblclick)="toggleZoom()"
                                                (touchstart)="handleDoubleTap($event); startDrag($event)"
                                                (mousedown)="startDrag($event)" (touchmove)="onDrag($event)"
                                                (mousemove)="onDrag($event)" (touchend)="endDrag()"
                                                (mouseup)="endDrag()" (mouseleave)="endDrag()"
                                                [style.transform]="zoomTransform"
                                                [style.cursor]="zoomLevel === 1 ? 'zoom-in' : 'grab'" />
                                </div>
                        </div>

                        <!-- Footer -->
                        <app-copyright [cliente]="nombreCliente" [marginBotClassDiv]="'mb-5'"></app-copyright>
                </section>
        </div>

        <!-- Scroll to top -->
        <app-scroll-to-top></app-scroll-to-top>
</div>