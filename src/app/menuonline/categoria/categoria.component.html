<app-background [imageUrl]="backgroundImage"></app-background>

<!-- Spinner -->
<app-spinner [@fadeInOut] *ngIf="loading"></app-spinner>

<!-- Contenido principal -->
<div [@fadeContent]>
        <div [ngClass]="clienteClass" class="carta-container" [style.--card-bg]="'url(' + cardImage + ')'">
                <section *ngIf="!loading" class="content fade-in" [class.fade]="true" [class.show]="visible">
                        <!-- Header -->
                        <app-header [cliente]="cliente" [src_path]="logoImage"></app-header>

                        <!-- Slider de categorías -->
                        <app-slider [categorias]="categorias" [cliente]="cliente" [categoriaActual]="categoria"
                                (categoriaSeleccionada)="onCategoriaSeleccionada($event)">
                        </app-slider>

                        <!-- Barra de búsqueda -->
                        <app-search-bar [item_placeholder]="item_placeholder" (search)="onSearch($event)">
                        </app-search-bar>

                        <!-- Contenedor de productos -->
                        <div class="container py-4">
                                <div class="row g-4 mt-3">
                                        @for (item of items; track item.idProducto || item.nombre) {
                                        <div class="col-md-4 px-4 text-center" id="cart-item">
                                                <div class="card shadow-sm border-3 rounded-5 overflow-hidden div-carta position-relative"
                                                        style="max-width: 400px;">
                                                        <div class="blurred-load text-center position-relative"
                                                                (click)="openLightbox(item.imagen)"
                                                                [style.backgroundImage]="'url(' + item.small_imagen + ')'">
                                                                <img [src]="item.imagen" [alt]="item.nombre"
                                                                        loading="lazy" decoding="async"
                                                                        class="img-fluid w-100 object-fit-cover"
                                                                        [srcset]="item.small_imagen + ' 320w, ' + item.imagen + ' 800w'"
                                                                        sizes="(max-width: 768px) 100vw, 400px"
                                                                        width="800" height="667"
                                                                        (error)="item.imagen = 'assets/placeholder.png'" />
                                                        </div>
                                                        <div class="blurred-img card-body text-center px-4 pb-4 position-relative"
                                                                id="cuerpo-card">
                                                                <div id="card-nombre" class="pb-2 px-1">
                                                                        <div class="card-title fw-bold text-uppercase">
                                                                                <span class="card-title-text">{{
                                                                                        item.nombre }}</span>
                                                                                <a *ngIf="whatsappNumber"
                                                                                        class="share-whatsapp"
                                                                                        [href]="buildWhatsappLink(item)"
                                                                                        target="_blank" rel="noopener"
                                                                                        aria-label="Compartir producto por WhatsApp"
                                                                                        title="Compartir por WhatsApp"
                                                                                        (click)="$event.stopPropagation()">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg" width="200" height="200" viewBox="0 0 1025 1024">
                                                                                                <path fill="#1e392e"
                                                                                                        d="M896.428 1024h-768q-53 0-90.5-37.5T.428 896V128q0-53 37.5-90.5t90.5-37.5h448v128h-384q-27 0-45.5 19t-18.5 45v640q0 27 18.5 45.5t45.5 18.5h640q27 0 45.5-18.5t18.5-45.5V530l128-107v473q0 53-37.5 90.5t-90.5 37.5zm-200-457q-13 13-34.5 8t-21.5-19V384q-224 0-384 320v-64q0-116 30-204t83-140t121-78t150-26V22q0-14 21.5-19.5t34.5 7.5l314 246q13 13 13 32t-13 33z" />
                                                                                        </svg>
                                                                                        <!-- <svg xmlns="http://www.w3.org/2000/svg"
                                                                                                viewBox="0 0 384 432"
                                                                                                aria-hidden="true"
                                                                                                focusable="false">
                                                                                                <path
                                                                                                        d="M320 303q26 0 44 18.5t18 44t-18 44t-44 18.5t-44-18.5t-18-44.5q0-6 1-14l-151-88q-19 17-44 17q-27 0-45.5-18.5T0 216t18.5-45.5T64 152q25 0 44 17l150-87q-2-9-2-15q0-27 18.5-45.5T320 3t45.5 18.5t18.5 45t-18.5 45.5t-45.5 19q-25 0-44-18l-150 88q2 9 2 15t-2 15l152 88q18-16 42-16z" />
                                                                                        </svg> -->
                                                                                </a>
                                                                        </div>
                                                                </div>
                                                                <div id="card-descripcion">
                                                                        <span id="card-descripcion-span"
                                                                                aria-hidden="true">“</span>
                                                                        {{ item.descripcion }}.
                                                                </div>
                                                                @if (item._variantesEntries) {
                                                                @for (v of item._variantesEntries; track v[0]) {
                                                                <div class="btn rounded-3 d-block" id="boton-card">
                                                                        {{ v[0] }}: ${{ v[1] }}
                                                                </div>
                                                                }
                                                                }
                                                                @if (item.precio && !item.variantes) {
                                                                <div class="btn rounded-3 d-block" id="boton-card">
                                                                        ${{ item.precio }}
                                                                </div>
                                                                }
                                                                @if (item._extrasEntries) {
                                                                @for (e of item._extrasEntries; track e[0]) {
                                                                <div class="btn rounded-3 d-block extras" id="boton-card">
                                                                        {{ e[0] }}: ${{ e[1] }}
                                                                </div>
                                                                }
                                                                }
                                                        </div>
                                                </div>
                                        </div>
                                        }

                                        <a [routerLink]="['/menuonline', cliente, 'carta']"
                                                class="btn button-add-cart checkout-button boton-volver">
                                                <span aria-hidden="true" style="padding-right: 7px;">↺</span>VOLVER
                                        </a>
                                </div>

                                <!-- Lightbox -->
                                <div class="lightbox" [class.show]="lightboxVisible"
                                        [class.hide]="!lightboxVisible && lightboxImage"
                                        (click)="closeLightbox($event)">
                                        <span *ngIf="zoomLevel === 1" class="lightbox-close"
                                                (click)="closeLightbox($event)" aria-label="Cerrar" tabindex="0"
                                                role="button"
                                                style="position: absolute; top: 24px; right: 32px; font-size: 2.5rem; color: #fff; z-index: 10; cursor: pointer; user-select: none;">
                                                &times;
                                        </span>
                                        <img class="lightbox-content" [src]="lightboxImage" (dblclick)="toggleZoom()"
                                                (touchstart)="handleDoubleTap($event); startDrag($event)"
                                                (mousedown)="startDrag($event)" (touchmove)="onDrag($event)"
                                                (mousemove)="onDrag($event)" (touchend)="endDrag()"
                                                (mouseup)="endDrag()" (mouseleave)="endDrag()"
                                                [style.transform]="zoomTransform"
                                                [style.cursor]="zoomLevel === 1 ? 'zoom-in' : 'grab'" />
                                </div>
                        </div>

                        <!-- Footer -->
                        <app-copyright [cliente]="nombreCliente" [marginBotClassDiv]="'mb-5'"></app-copyright>
                </section>
        </div>

        <!-- Scroll to top -->
        <app-scroll-to-top></app-scroll-to-top>
</div>
