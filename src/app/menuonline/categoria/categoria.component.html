<app-background [imageUrl]="backgroundImage"></app-background>

<!-- Spinner -->
<app-spinner [@fadeInOut] *ngIf="loading"></app-spinner>
<p-confirmDialog [style]="{ width: 'min(92vw, 460px)' }"></p-confirmDialog>

<!-- Contenido principal -->
<div [@fadeContent]>
        <div [ngClass]="clienteClass" class="carta-container" [style.--card-bg]="'url(' + cardImage + ')'">
                <section *ngIf="!loading" class="content fade-in" [class.fade]="true" [class.show]="visible">
                        <!-- Header -->
                        <app-header [cliente]="cliente" [src_path]="logoImage"></app-header>

                        <!-- Slider de categorías -->
                        <app-slider [categorias]="categorias" [cliente]="cliente" [categoriaActual]="categoria"
                                (categoriaSeleccionada)="onCategoriaSeleccionada($event)">
                        </app-slider>

                        <!-- Barra de búsqueda -->
                        <app-search-bar [item_placeholder]="item_placeholder" (search)="onSearch($event)">
                        </app-search-bar>

                        <!-- Contenedor de productos -->
                        <div class="container py-4">
                                <div class="row g-4 mt-3">
                                        @for (item of items; track item.idProducto || item.nombre) {
                                        <div class="col-md-4 px-4 text-center" id="cart-item">
                                                <div class="card shadow-sm border-3 rounded-5 overflow-hidden div-carta position-relative"
                                                        style="max-width: 400px;">
                                                        <div class="blurred-load text-center position-relative"
                                                                (click)="openLightbox(item.imagen)"
                                                                [style.backgroundImage]="'url(' + item.small_imagen + ')'">
                                                                <img [src]="item.imagen" [alt]="item.nombre"
                                                                        loading="lazy" decoding="async"
                                                                        class="img-fluid w-100 object-fit-cover"
                                                                        [srcset]="item.small_imagen + ' 320w, ' + item.imagen + ' 800w'"
                                                                        sizes="(max-width: 768px) 100vw, 400px"
                                                                        width="800" height="667"
                                                                        (error)="item.imagen = 'assets/placeholder.png'" />
                                                        </div>
                                                        <div class="blurred-img card-body text-center px-4 pb-4 position-relative"
                                                                id="cuerpo-card">
                                                                <div id="card-nombre" class="pb-2 px-1">
                                                                        <div class="card-title fw-bold text-uppercase">
                                                                                <span class="card-title-text">{{item.nombre}}</span>
                                                                                @if(item.isVegan) {
                                                                                <button type="button"
                                                                                        class="icon-info-button"
                                                                                        aria-label="Información producto vegano"
                                                                                        title="Producto vegano"
                                                                                        (click)="showVeganInfo($event)">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                                                width="23" viewBox="0 0 24 24"
                                                                                                fill="#1E382D">
                                                                                                <g fill="none"
                                                                                                        stroke="#1E382D"
                                                                                                        stroke-linecap="round"
                                                                                                        stroke-linejoin="round"
                                                                                                        stroke-width="2">
                                                                                                        <path
                                                                                                                d="M2 2a26.6 26.6 0 0 1 10 20c.9-6.82 1.5-9.5 4-14m0 0c4 0 6-2 6-6c-4 0-6 2-6 6" />
                                                                                                        <path
                                                                                                                d="M17.41 3.6a10 10 0 1 0 3 3" />
                                                                                                </g>
                                                                                        </svg>
                                                                                </button>
                                                                                }
                                                                                @if (item.isGlutenFree) {
                                                                                <button type="button"
                                                                                        class="icon-info-button"
                                                                                        aria-label="Información producto sin gluten"
                                                                                        title="Producto sin gluten"
                                                                                        (click)="showGlutenFreeInfo($event)">
                                                                                        <svg class="gluten-free-icon"
                                                                                                xmlns="http://www.w3.org/2000/svg"
                                                                                                viewBox="0 0 48 48"
                                                                                                aria-hidden="true"
                                                                                                role="img"
                                                                                                focusable="false">
                                                                                                <path fill-rule="evenodd"
                                                                                                        d="M44 24c0 11.046-8.954 20-20 20S4 35.046 4 24S12.954 4 24 4s20 8.954 20 20m-7.999 13.416A17.933 17.933 0 0 1 24 42c-9.941 0-18-8.059-18-18c0-4.738 1.83-9.048 4.823-12.263l3.97 3.97a1 1 0 0 0 1.414-1.414l-3.942-3.942A17.93 17.93 0 0 1 24 6c9.941 0 18 8.059 18 18c0 4.61-1.734 8.817-4.584 12.001l-8.545-8.544A5.726 5.726 0 0 0 31 23l-2.162.34A5.723 5.723 0 0 0 25 25.766v-2.923l1.162-.183A5.73 5.73 0 0 0 31 17l-2.162.34A5.723 5.723 0 0 0 25 19.766V18l.465-.465a5 5 0 0 0 0-7.07L24 9l-1.464 1.464a5 5 0 0 0 0 7.071L23 18v1.766a5.723 5.723 0 0 0-3.838-2.426L17 17a5.73 5.73 0 0 0 4.838 5.66l1.162.183v2.923a5.723 5.723 0 0 0-3.838-2.426L17 23a5.73 5.73 0 0 0 4.838 5.66l1.162.183v2.923a5.723 5.723 0 0 0-3.838-2.426L17 29a5.73 5.73 0 0 0 4.838 5.66l1.162.183V38h2v-3.547a1.78 1.78 0 0 0 1.162.207a5.727 5.727 0 0 0 4.15-2.935zm-7.907-7.907l-1.057-1.058a5.753 5.753 0 0 1-.875.209L25 28.843v2.923a5.727 5.727 0 0 1 3.094-2.257"
                                                                                                        clip-rule="evenodd" />
                                                                                        </svg>
                                                                                </button>
                                                                                }
                                                                                <a *ngIf="whatsappNumber"
                                                                                        class="share-whatsapp"
                                                                                        [href]="buildWhatsappLink(item)"
                                                                                        target="_blank" rel="noopener"
                                                                                        aria-label="Compartir producto por WhatsApp"
                                                                                        title="Compartir por WhatsApp"
                                                                                        (click)="onShareClick($event, item)">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 32 32" fill="#1e392e">
                                                                                                <path fill="#1e392e"
                                                                                                        d="M4 7a1 1 0 0 0 0 2h2.22l2.624 10.5c.223.89 1.02 1.5 1.937 1.5h12.47c.903 0 1.67-.6 1.907-1.47L27.75 10h-2.094l-2.406 9H10.78L8.157 8.5A1.984 1.984 0 0 0 6.22 7H4zm18 14c-1.645 0-3 1.355-3 3s1.355 3 3 3s3-1.355 3-3s-1.355-3-3-3zm-9 0c-1.645 0-3 1.355-3 3s1.355 3 3 3s3-1.355 3-3s-1.355-3-3-3zm3-14v5h-3l4 4l4-4h-3V7h-2zm-3 16c.564 0 1 .436 1 1c0 .564-.436 1-1 1c-.564 0-1-.436-1-1c0-.564.436-1 1-1zm9 0c.564 0 1 .436 1 1c0 .564-.436 1-1 1c-.564 0-1-.436-1-1c0-.564.436-1 1-1z" />
                                                                                        </svg>
                                                                                </a>
                                                                        </div>
                                                                </div>
                                                                <div id="card-descripcion">
                                                                        <span id="card-descripcion-span"
                                                                                aria-hidden="true">“</span>
                                                                        {{ item.descripcion }}.
                                                                </div>
                                                                @if (item._variantesEntries) {
                                                                @for (v of item._variantesEntries; track v[0]) {
                                                                <div class="btn rounded-3 d-block" id="boton-card">
                                                                        {{ v[0] }}: ${{ v[1] }}
                                                                </div>
                                                                }
                                                                }
                                                                @if (item.precio && !item.variantes) {
                                                                <div class="btn rounded-3 d-block" id="boton-card">
                                                                        ${{ item.precio }}
                                                                </div>
                                                                }
                                                                @if (item._extrasEntries) {
                                                                @for (e of item._extrasEntries; track e[0]) {
                                                                <div class="btn rounded-3 d-block extras"
                                                                        id="boton-card">
                                                                        {{ e[0] }}: ${{ e[1] }}
                                                                </div>
                                                                }
                                                                }
                                                        </div>
                                                </div>
                                        </div>
                                        }

                                        <a [routerLink]="['/menuonline', cliente, 'carta']"
                                                class="btn button-add-cart checkout-button boton-volver">
                                                <span aria-hidden="true" style="padding-right: 7px;">↺</span>VOLVER
                                        </a>
                                </div>

                                <!-- Lightbox -->
                                <div class="lightbox" [class.show]="lightboxVisible"
                                        [class.hide]="!lightboxVisible && lightboxImage"
                                        (click)="closeLightbox($event)">
                                        <span *ngIf="zoomLevel === 1" class="lightbox-close"
                                                (click)="closeLightbox($event)" aria-label="Cerrar" tabindex="0"
                                                role="button"
                                                style="position: absolute; top: 24px; right: 32px; font-size: 2.5rem; color: #fff; z-index: 10; cursor: pointer; user-select: none;">
                                                &times;
                                        </span>
                                        <img class="lightbox-content" [src]="lightboxImage" (dblclick)="toggleZoom()"
                                                (touchstart)="handleDoubleTap($event); startDrag($event)"
                                                (mousedown)="startDrag($event)" (touchmove)="onDrag($event)"
                                                (mousemove)="onDrag($event)" (touchend)="endDrag()"
                                                (mouseup)="endDrag()" (mouseleave)="endDrag()"
                                                [style.transform]="zoomTransform"
                                                [style.cursor]="zoomLevel === 1 ? 'zoom-in' : 'grab'" />
                                </div>
                        </div>

                        <!-- Footer -->
                        <app-copyright [cliente]="nombreCliente" [marginBotClassDiv]="'mb-5'"></app-copyright>
                </section>
        </div>

        <!-- Scroll to top -->
        <app-scroll-to-top></app-scroll-to-top>
</div>
